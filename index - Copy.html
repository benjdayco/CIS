
<head>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans|Raleway' rel='stylesheet' type='text/css'>
  <style>
    html, body, #map-canvas {
      height: 100%;
      margin: 0px;
      padding: 0px;
      font-family: 'Raleway', sans-serif;
      z-index:1;
    }
  
    #draggable {
      z-index:100; 
      background-color: rgba(200,200,255,.7); 
      width: 250px;
      padding: 20px;
      position:absolute;
      top:10px;
      left:100px;
      cursor: move;
      border: black 1px solid;
    }
    #radius-label, #opacity-label, #max-label {
      margin-top: 10px;
    }
    #radius-slider, #opacity-slider, #max-slider {
      width:250px;
      margin-top: 10px;
    }
    #project {
      font-size: 10pt;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #radius-slider .ui-slider-handle, 
    #opacity-slider .ui-slider-handle,
    #max-slider .ui-slider-handle {
      cursor:pointer;
    }
  </style>
  
  <script src="js/papaparse.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDQiCo59iNzTIFXLlmre8HpZ48JhD5eYfU&v=3.exp&libraries=visualization"></script>

   <script src="js/jquery.min.js"></script>
  <script src="https://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css">

  <script>
    var map, pointarray, heatmap;
    var csv = [];
    // http://stackoverflow.com/a/2901298/562440
    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    function loadData() {
    
     var data = "\"weight\",\"lat\",\"lon\",\"cnt\"\n167,34.543896,69.160652,AFG\n44,40.1772,44.50349,'ARM'\n63,40.409264,49.867092,AZE\n768,23.728783,90.393791,BAN\n197,27.4728,89.6393,BHU\n2,4.5353,114.7277,BRU\n400,12.5657,104.991,CAM\n57,21.2367,159.7777,COO\n117,17.7134,178.065,FIJ\n67,7.4256,150.5508,FSM\n47,41.716667,44.783333,GEO\n5,22.3964,114.1095,HKG\n644,20.5937,78.9629,IND\n952,0.7893,113.9213,INO\n117,43.238949,76.889709,KAZ\n176,41.2044,74.7661,KGZ\n59,3.3704,168.734,KIR\n112,35.9078,127.7669,KOR\n459,19.8563,102.4955,LAO\n170,4.2105,101.9758,MAL\n99,3.2028,73.2207,MLD\n328,46.8625,103.8467,MON\n153,21.9162,95.956,MYA\n22,0.5228,166.9315,NAU\n605,28.3949,84.124,NEP\n756,30.3753,69.3451,PAK\n13,7.515,134.5825,PAL\n685,12.8797,121.774,PHI\n268,6.315,143.9555,PNG\n1169,35.8617,104.1954,PRC\n77,7.1315,171.1845,RMI\n162,13.759,172.1046,SAM\n17,1.3521,103.8198,SIN\n132,9.6457,160.1562,SOL\n516,7.8731,80.7718,SRI\n154,38.861,71.2761,TAJ\n14,23.6978,120.9605,TAP\n279,15.87,100.9925,THA\n74,8.8742,125.7275,TIM\n9,38.9697,59.5563,TKM\n100,21.179,175.1982,TON\n36,7.1095,177.6493,TUV\n187,41.3775,64.5853,UZB\n94,15.3767,166.9592,VAN\n585,14.0583,108.2772,VIE"
      Papa.parse(data, {
        header: true,
        dynamicTyping: true,
        complete: function(results) {
          csv = [];
          if(results.meta.fields.indexOf("weight") == -1) {
            for(idx in results["data"]) {
              var row = results["data"][idx];
              csv.push(new google.maps.LatLng(row["lat"], row["lon"]))
            }
          } else {
            var max = results["data"][0]["weight"];
            for(idx in results["data"]) {
              var row = results["data"][idx];
              
              max = Math.max(max, row["weight"]);
              csv.push({
                location: new google.maps.LatLng(row["lat"], row["lon"]),
                weight: row["weight"]
              });
            }
            $("#max-label").html("max: "+numberWithCommas(max));
            $("#max-slider").slider("option","max",max);
            $("#max-slider").slider("option","value",max);
          }
          
          console.log(results);
                    
          loadHeatmap(csv);
        }
      });
    }
    
    function initialize() {
      var mapOptions = {
      zoom: 3,
      center: new google.maps.LatLng(34, 100),
      mapTypeId: google.maps.MapTypeId.MAP
      };
      map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);

      loadData();
    }
    
    function loadHeatmap(csv) {
      var pointArray = new google.maps.MVCArray(csv);
      if(heatmap) heatmap.setMap(null);
      
      heatmap = new google.maps.visualization.HeatmapLayer({
        data: pointArray,
        radius: $("#radius-slider").slider("value"),
        opacity: $("#opacity-slider").slider("value")
      });
      
      heatmap.setMap(map);
    }
    
    $(document).ready(function(){
      
      google.maps.event.addDomListener(window, 'load', initialize);
      
      $(function() {
        $( "#draggable" ).draggable();
      });
      
      $(function() {
        $( "#radius-slider" ).slider({
          orientation: "horizontal",
          range: "min",
          min: 1,
          max: 50,
          value: 20,
          slide: function(event, ui) {
            $("#radius-label").html("radius: " + ui.value);
            if(heatmap == null) return;
            heatmap.set('radius', ui.value);
          }
        });
        $( "#opacity-slider" ).slider({
          orientation: "horizontal",
          range: "min",
          min: 0,
          max: 100,
          value: 50,
          slide: function(event, ui) {
            $("#opacity-label").html("opacity: " + ui.value/100);
            if(heatmap == null) return;
            heatmap.set('opacity', ui.value/100);
          }
        });
        $( "#max-slider" ).slider({
          orientation: "horizontal",
          range: "min",
          min: 0,
          max: 1,
          value: 0,
          slide: function(event, ui) {
            $("#max-label").html("max: " + numberWithCommas(ui.value));
            if(heatmap == null) return;
            heatmap.set('maxIntensity', ui.value);
          }
        });
      });
       
    });
 
  </script>
     
</head>
<body>
  <!-- there goes the map -->
  <div id="map-canvas"> </div>

  <!-- the draggable input and display controls -->
  <div id="draggable">
   
    <div id="radius-label">radius: 20</div>
    <div id="radius-slider"></div>

    <div id="opacity-label">opacity: 0.5</div>
    <div id="opacity-slider"></div>

    <div id="max-label">max: -</div>
    <div id="max-slider"></div>
  </div>
</body>

<!--
https://developer.mozilla.org/en-US/docs/Using_files_from_web_applications
http://www.html5rocks.com/en/tutorials/file/dndfiles/
http://blog.teamtreehouse.com/reading-files-using-the-html5-filereader-api
-->
Contact GitHub API Training Shop Blog About
Â© 2017 GitHub, Inc. Terms Privacy Security Status Help